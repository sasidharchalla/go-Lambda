name: CI
on:
 push:
  branches: 
    - main
  paths:
    - backend/lambda/**
env:
  Deploy_Route_Url: ${{secrets.AWS_DEPLOY_DEV_ENV}}
  Lambda_Location: "backend/lambda/"

jobs:
 build:
 
  runs-on: ubuntu-latest
  strategy: 
    matrix:
      go-version: [1.17]
  steps:
   - name: check the code
     uses: actions/Checkout@v2
  
   - name: Get changed files
     id: files
     uses: jitterbit/get-changed-files@v1
     with:
       format: 'json'

   - name: Verify Added/Modified files for logging purposes
     run: |
       readarray -t added_modified_files <<<"$(jq -r '.[]' <<<'${{ steps.files.outputs.added_modified }}')"
       for added_modified_file in "${added_modified_files[@]}"; do
         echo "${added_modified_file}"
       done
   
   - name: Verify Removed files for logging purposes
     run: |
       readarray -t removed_files <<<"$(jq -r '.[]' <<<'${{ steps.files.outputs.removed }}')"
       for removed_file in ${removed_files[@]}; do
         echo "${removed_file}."
       done

  #  - name: setup go

  #    uses: actions/setup-go@v2
  #    with:
  #      go-version: ${{ matrix.go-version }}
  #    env:
  #     GO111MODULE: "on"
 
  #  - name: check setup
  #    run: |
     
  #      go mod init leapfrog-backend-Go-Lambdas
  #      go mod tidy
    
   - name: codebuld    
     run: |
       env GOOS=linux
       readarray -t added_modified_files <<<"$(jq -r '.[]' <<<'${{ steps.files.outputs.added_modified }}')"
       for added_modified_file in "${added_modified_files[@]}"; do
         if [(echo "${added_modified_file}"| grep -b -o ${{env.Lambda_Location}}) == 0]
         then
           echo "${added_modified_file}"
         fi
       done


 
     
